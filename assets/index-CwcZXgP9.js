(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))n(t);new MutationObserver(t=>{for(const o of t)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function s(t){const o={};return t.integrity&&(o.integrity=t.integrity),t.referrerPolicy&&(o.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?o.credentials="include":t.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(t){if(t.ep)return;t.ep=!0;const o=s(t);fetch(t.href,o)}})();let y=null,T=null;const E=document.querySelector("#toc"),g=document.querySelector("#book-content"),w=document.querySelector("#chapter-title"),L=document.querySelector("#sidebar"),N=document.querySelector("#sidebar-toggle"),q=document.querySelector("#sidebar-overlay"),M=document.querySelector("#sidebar-close");function A(){L.classList.add("active"),q.classList.add("active")}function k(){L.classList.remove("active"),q.classList.remove("active")}async function W(){try{localStorage.getItem("sidebarCollapsed")==="true"&&L.classList.add("collapsed"),N.addEventListener("click",()=>{window.innerWidth<=768?L.classList.contains("active")?k():A():(L.classList.toggle("collapsed"),localStorage.setItem("sidebarCollapsed",L.classList.contains("collapsed")))}),q.addEventListener("click",k),M&&M.addEventListener("click",k);const a=document.getElementById("collapse-all-btn");a&&a.addEventListener("click",o=>{o.stopPropagation(),E.querySelectorAll(".expanded").forEach(c=>c.classList.remove("expanded"))}),y=await(await fetch(`/books/data/library.json?v=${Date.now()}`)).json(),P(),x();const t=document.querySelector(".logo");t&&(t.style.cursor="pointer",t.addEventListener("click",o=>{o.target.closest("#collapse-all-btn")||o.target.closest("#sidebar-close")||(x(),window.innerWidth<=768&&k())}))}catch(e){console.error("Failed to initialize app:",e),g&&(g.innerHTML='<p class="error">Failed to load content. Please check console.</p>')}}function P(){E&&(E.innerHTML="",y.books&&y.books.forEach(e=>{const a=document.createElement("div");a.className="book-group";const s=document.createElement("div");s.className="book-header";const n='<svg class="book-icon" viewBox="0 0 24 24" width="24" height="24" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path></svg>';s.innerHTML=`${n} <h2 class="book-title-text">${e.title}</h2>`,s.onclick=()=>{const o=a.classList.contains("expanded");E.querySelectorAll(".book-group").forEach(l=>l.classList.remove("expanded")),o||a.classList.add("expanded")},a.appendChild(s);const t=document.createElement("div");t.className="book-chapters",e.chapters.forEach((o,l)=>{const c=document.createElement("div");c.className="sidebar-item chapter-link",c.dataset.id=o.id;const r=`${l+1}.`,f=o.title,p=document.createElement("div");if(p.className="chapter-header",p.innerHTML=`<h3><span class="ch-num">${r}</span> <span>${f}</span></h3>`,p.onclick=b=>{const m=c.classList.contains("expanded");t.querySelectorAll(".sidebar-item").forEach(u=>u.classList.remove("expanded")),m||c.classList.add("expanded")},c.appendChild(p),o.sections){const b=document.createElement("ul");b.className="chapter-sections",o.sections.forEach(m=>{const u=document.createElement("li");u.className="section-link",u.dataset.id=m.id;const $=m.title.match(/^(§\s*\d+\.\d+\.?|\d+\.\d+\.?)\s*(.*)$/),h=$?$[1]:m.id.includes("problems")?"?":"",S=$?$[2]:m.title;e.id==="irodov_problems"&&u.classList.add("is-problems-section"),u.innerHTML=`<span class="sec-num">${h}</span><span class="sec-title">${S}</span>`,u.onclick=i=>{i.stopPropagation(),O(e,o.id,m.id),window.innerWidth<=768&&k()},b.appendChild(u)}),c.appendChild(b)}t.appendChild(c)}),a.appendChild(t),E.appendChild(a)}))}function x(){T=null,w&&(w.textContent="Физикийн Номын Сан"),document.querySelectorAll(".section-link.active").forEach(a=>a.classList.remove("active")),document.querySelectorAll(".sidebar-item.active-chapter").forEach(a=>a.classList.remove("active-chapter"));let e=`
    <div class="home-page">
      <div class="home-header-content">
        <h2>Тавтай морилно уу!</h2>
        <p>И.Е. Иродовын болон бусад физикийн сурах бичиг, бодлогын хураамжуудаас сонгон уншина уу. Энэхүү цахим номын сан нь физикийн шинжлэх ухааныг гүнзгийрүүлэн судлахад тань туслах зорилготой.</p>
      </div>
      <div class="book-grid">
  `;y&&y.books&&y.books.forEach(a=>{let s=`onclick="const h = document.querySelector('.sidebar-item[data-id=\\'${a.chapters[0]?.id}\\'] .chapter-header'); if(h) h.click(); document.querySelector('.sidebar-item[data-id=\\'${a.chapters[0]?.id}\\'] .section-link').click();"`;e+=`
        <div class="book-card" ${s}>
          <div class="book-card-icon">
            <svg viewBox="0 0 24 24" width="48" height="48" stroke="currentColor" stroke-width="1.5" fill="none" class="text-primary"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path></svg>
          </div>
          <h3 class="book-card-title">${a.title}</h3>
          <p class="book-card-desc">${a.chapters.length} бүлэгтэй</p>
        </div>
      `}),e+=`
      </div>
    </div>
  `,g&&(g.innerHTML=e)}async function O(e,a,s=null){try{const n=e.chapters.find(r=>r.id===a);if(!n)return;let t=null;const o="/books/";if(n.folder&&s){const r=n.sections.find(f=>f.id===s);r&&r.file&&(t=`${o}data/${n.folder}/${r.file}`)}else if(n.file)t=`${o}data/chapters/${n.file}`;else if(n.folder&&!s&&n.sections.length>0){const r=n.sections[0];t=`${o}data/${n.folder}/${r.file}`,s=r.id}if(!t){console.warn("No file content mapped for this section."),s&&alert("Энэ хэсгийн агуулга одоогоор бэлэн болоогүй байна.");return}document.getElementById("book-content").className="";const c=await(await fetch(t)).json();T={...n,...c},j(c),U(a,s),setTimeout(()=>{window.scrollTo({top:0,behavior:"smooth"}),window.MathJax&&window.MathJax.typesetPromise()},100)}catch(n){console.error("Failed to load chapter:",n)}}function U(e,a){document.querySelectorAll(".section-link").forEach(n=>n.classList.remove("active")),document.querySelectorAll(".sidebar-item").forEach(n=>n.classList.remove("active-chapter"));const s=document.querySelector(`.sidebar-item[data-id="${e}"]`);if(s&&(s.classList.add("active-chapter"),s.classList.add("expanded")),a){const n=s?s.querySelector(`.section-link[data-id="${a}"]`):null;n&&n.classList.add("active")}}function j(e){g&&(w&&(w.textContent=e.title),g.innerHTML="",e.body.forEach(a=>{const s=C(a);s&&g.appendChild(s)}))}function C(e){switch(e.type){case"text":const a=document.createElement("p");return(e.value.includes("Бодолт")||e.value.trim().startsWith("<b>Бодолт")||e.value.includes("Шийдэл")||e.value.trim().startsWith("<b>Шийдэл"))&&(a.className="solution-text"),a.innerHTML=v(e.value),a;case"header":const s=document.createElement("h2");return e.id&&(s.id=e.id),s.textContent=e.value,s;case"note":const n=document.createElement("div");return n.className="note-box",n.innerHTML=v(e.value),n;case"problem":const t=document.createElement("div");t.className="problem-container";let o=`<div class="problem-header"><strong>${e.number||""} ${e.title||""}</strong></div>`;if(o+=`<div class="problem-statement">${v(e.statement)}</div>`,e.image){const i="/books/";let d=e.image.src;d.startsWith("/")&&(d=d.substring(1)),d.startsWith("images/")&&(d=d.substring(7));const H=`${i}images/${d}`;o+=`
          <div class="image-container">
            <img src="${H}" alt="${e.image.caption||""}">
            ${e.image.caption?`<p class="caption">${e.image.caption}</p>`:""}
          </div>
        `}const l=document.createElement("div");l.className="problem-buttons";const c=document.createElement("div");if(c.className="problem-answer hidden",e.answer){c.innerHTML=`<strong>Хариу:</strong> ${v(e.answer)}`;const i=document.createElement("button");i.className="btn-toggle btn-answer",i.innerText="Хариу харах",i.onclick=()=>{c.classList.toggle("hidden"),i.innerText=c.classList.contains("hidden")?"Хариу харах":"Хариу нуух"},l.appendChild(i)}const r=document.createElement("div");if(r.className="problem-solution hidden",e.solution){r.innerHTML=`<strong>Бодолт:</strong> ${v(e.solution)}`;const i=document.createElement("button");i.className="btn-toggle btn-solution",i.innerText="Бодолт харах",i.onclick=()=>{r.classList.toggle("hidden"),i.innerText=r.classList.contains("hidden")?"Бодолт харах":"Бодолт нуух",!r.classList.contains("hidden")&&window.MathJax&&window.MathJax.typesetPromise([r])},l.appendChild(i)}return t.innerHTML=o,t.appendChild(l),t.appendChild(c),t.appendChild(r),t;case"section":const f=document.createElement("section");return f.id=e.id,f.innerHTML=`<h2>${e.title}</h2>`,e.body.forEach(i=>{const d=C(i);d&&f.appendChild(d)}),f;case"subsection":const p=document.createElement("div");return p.className="subsection",p.innerHTML=`<h3>${e.title}</h3>`,e.body.forEach(i=>{const d=C(i);d&&p.appendChild(d)}),p;case"equation":const b=document.createElement("div");b.className="equation-wrapper";const m=e.tag?`<span class="equation-tag">(${e.tag})</span>`:"";return b.innerHTML=`\\[ ${e.value} \\] ${m}`,b;case"image":const u=document.createElement("div");u.className="image-container";const $="/books/";let h=e.src;h.startsWith("/")&&(h=h.substring(1)),h.startsWith("images/")&&(h=h.substring(7));const S=`${$}images/${h}`;return u.innerHTML=`
        <img src="${S}" alt="${e.caption||""}">
        ${e.caption?`<p class="caption">${e.caption}</p>`:""}
      `,u;default:return null}}function v(e){return e?Array.isArray(e)?e.map(s=>{if(s.type==="text")return v(s.value);if(s.type==="equation"){const n=s.tag?`<span class="equation-tag">(${s.tag})</span>`:"";return`<div class="equation-wrapper">\\[ ${s.value} \\] ${n}</div>`}if(s.type==="image"){const n="/books/";let t=s.src||s.value;return t&&t.startsWith("/")&&(t=t.substring(1)),t&&t.startsWith("images/")&&(t=t.substring(7)),`<div class="image-container"><img src="${n}images/${t}" alt="${s.caption||""}">${s.caption?`<p class="caption">${s.caption}</p>`:""}</div>`}return""}).join(""):typeof e!="string"?"":e.replace(/\$\$(.+?)\$\$/gs,(s,n)=>`\\[${n}\\]`).replace(/\$([^$]+)\$/g,(s,n)=>`\\(${n.trim()}\\)`):""}W();
